\chapter{State of the Art: Frameworks to Control Aerial Robot Swarms}

{\color{red}
\begin{itemize}
    \item Improve the presentation of this chapter
    \item Discuss about the different requirements not by solution to use
    \item Make a table of the features by software solution
    \item Make transition between autopilot and fight controller
    \item Improve conclusion
\end{itemize}
}


As the crazyflies cannot be used to communicate at high speed with low latency to an offboard computer like raspberry py and has not much space and power to accomodate an offboard computer.
The custom drone solution was chosen.




For the following discussion it is assumed that the drone has an companion computer.
The aim is to test a computationally demanding low-level control algorithm directly controlling the speed of the motor of the drone. This is today impossible on most of the available flight controllers.

\section{Autopilot software}

\subsection{ROSflight \& ROScopter}
The core strength of ROSflight is that it has been designed to control a drone with a companion computer, and it has an easy-to-understand code base that is kept lean.
It is easy to build on top of ROSflight to add functionalities. The project ROScopter \cite{github_roscopter} for example add the support of waypoint position control.

There is only a few flight controller that are know to be compatible with ROSflight (e.g. OpenPilot Revolution and PixHawk).
So, if another flight controller is chosen, some more configurations would have to be done.

ROS is a core functionality of ROSflight.

ROSflight have a \gls{sitl} simulator.

It should be possible to directly control the speed of the motors \cite{github_rosflight_98}.

\subsection{ArduPilot}
ArduPilot and more precisely ArduCopter has a lot of features.
It has numerous flight modes.
\Gls{ekf} is computed on the flight controller.
It has its own Ground Control Station to flash its firmware and modify settings.
ArduPilot is compatible with a lot of flight controller
It has a strong community.
It has a really good documentation.
It is tested a lot and the users report problem when they arise.

ArduPilot be used  with ROS.

ArduPilot also have a \gls{sitl} simulator.

It is possible to directly control the speed of the motors \cite{github_ardupilot_11859}.

\subsection{PX4}
PX4 has a lot of features.
It has numerous flight modes.
\Gls{ekf} is computed on the flight controller.
It has its own Ground Control Station to flash firmware and modify the settings.
It has a strong community.
It has a good documentation.
It is tested a lot and the users report problem when they arise.

PX4 be used  with ROS.

PX4 also have a SITL simulator.

It should be possible to directly control the speed of the motors \cite{px4_low_level_control}.

\section{A comparison between the different Frameworks}
These blog posts provide a comparison of open source drone software frameworks \cite{drone_software_projects} and many flight controllers \cite{drone_flight_controllers}.

\subsection{Communication}
The communication between the companion computer and the flight controller of the drones are done with the MAVlink protocol. All firmware use MAVlink but each firmware has its own implementation.

\subsection{ROS}
Every autopilot software can interface with ROS. But, there is only PX4 that compatible with ROS2.

ROS2 is a new version of ROS that can be use without a master, it supports real-time and it has retro-compatibility with ROS1. But, it is still under heavy development, it is advise to use ROS2 only if its features are indispensable.

\subsection{Vicon}
There are project that used vicon with ArduPilot \cite{ardupilot_vicon} and PX4 \cite{px4_vicon}.

\subsection{Extended Kalman Filter}
Both ArduPilot and PX4 have an EKF running on the flight controller contrarily to ROSflight where it is an extension given by ROScopter.

It is possible to give the absolute postion data from the motion capture system to the EKF of ArduPilot and PX4 but not ROSflight as it has not been implemented.

\subsection{Direct control of motor speed}
Every autopilot software has solution to directly control the motor speed but only ArduPilot has a solution that is already implemented.

\subsection{Swarm compatibility}
Both ArduPilot \cite{ardupilot_multi_vehicle} and PX4 \cite{px4_multi_vehicle}
have proof of concept that swarm of drone are possible.

It should be possible for ROSflight \cite{github_rosflight_100} too.
But, some firmware modification has to be done.

\subsection{Simulator}
All firmware have SIL/SITL simulator.
Only PX4 can simulate multiple drone out of the box.

\subsection{Flight controller}
\subsubsection{OpenPilot Revolution}
It is compatible with ROSflight and ArduPilot. It is a popular flight controller.
It comes with all the connectors needed \cite{bangood_revo}.


\subsubsection{PixHawk 2.4.8/PixRacer}
The PixHawk is compatible with every firmware.
It is the flight controller use by everyone, there is a lot of documentation, project. And ArduPilot recommend using it \cite{ardupilot_choose_fc}.
A small version of it is the PixRacer that is more abordable and adapted for this project \cite{mrobotics_pixracer}.

\subsubsection{Navio2+Raspberry Pi 4}
As the Raspberry Pi 4 has just been released it has different problems that has not been solved such as overheating, firmware problemsâ€¦ It is not software compatible with the NAVIO2 at the moment, they will release an new image when they will have done some test. It is adviced to wait until it had a bit of time on the market. So for now the raspberry pi 4 is not reliable enough for this project \cite{ardupilot_rpi_compatibility}.

If we use the Raspberry Pi 3B+ with Navio2.

Here is a blog post about Navio2 + Raspberry Pie \cite{dojofordrones_rpi_drone}.

It is not recommended to directly control pwm and bypassing ArduPilot that is running \cite{emlid_servo_control}. It is recommended to control pwm via ArduPilot. It has to communicate via MAVLINK like the other flight controllers.

\subsection{On-board Computer}
\subsubsection{Nvidia Jetson Nano}
This computer is quite recent and it has only the latest version of Ubuntu that is Ubuntu 18.04.
But Ubuntu 16.04 is the version that is the most used at the moment in the drone world.
There not much support for it at the moment.

It is also bigger and heavier than it counterpart the Raspberry Pi. It is mainly due to its better performance, better graphic card and processor.

\subsubsection{Raspberry Pi}
The Raspberry Pi is one of the most companion computer use. It is lighter and smaller than the Jetson Nano.

A lot of project have been done with it.

There is a shield produce by the emlid company called Navio2. That add the functionality of flight controller to it.

\section{Conclusion}
ROSflight is a lightweight solution where every new functionality has to be implemented.
It does not have a large community to help with questions and all the features of ArduPilot and PX4. So, the choice is between ArduPilot and PX4

Raspberry Pi and Navio is the most compact solution that exist and it comes with ArduPilot and ROS already installed with it.

Ardupilot is the solution chosen. PX4 is still an option that can be explored in the future of this project.
